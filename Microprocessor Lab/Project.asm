CODE SEGMENT
ASSUME CS:CODE
ORG 1000H
JMP START
VAR DW 0
FLAG DB 0
;SPEED DW 500
DEG DW 0
START:

; 8255 CONFIGURATION
MOV DX, 0FF2BH
MOV AL, 82H
OUT DX, AL

; KEYPAD CONFIGURATION
MOV DX, 8001H
MOV AL, 0
OUT DX, AL

; PROGRAM CLOCK CONFIGURATION
MOV AL, 00110010B
OUT DX, AL

; CLEAR CONFIGURATION
MOV AL, 11011111B
OUT DX, AL

CALL DELAY

MOV AH, 85H

L1:
NO:
MOV DX, 8001H
IN AL, DX
AND AL, 07H
JZ NO

MOV DX, 8000H
IN AL, DX
AND AL, 3FH
MOV BL, AL
MOV BH, 0
AND AL, 00000111B
AND BL, 00111000B
SAR BL, 3
MOV VAR, BX
CMP AL, 00000000B
JE A1
CMP AL, 00000001B
JE A2
JMP L1
CONT:
MOV BX, VAR
MOV DX, 8001H
CMP AH, 80H
JE FIX
MOV AL, AH
DEC AH
OUT DX, AL
MOV DX, 8000H
MOV AL, [SI + BX]
OUT DX, AL
MOV BL, [DI + BX]
MOV BH, 0
PUSH BX
JMP L1

A1:
LEA SI, ARR1
LEA DI, ARR1N
JMP CONT

A2:
LEA SI, ARR2
LEA DI, ARR2N
JMP CONT

FIX:
JMP CALC
CONT2:
JMP MOVE
CONT3:
MOV AH, 85H
MOV CX, 5
A3:
MOV AL, AH
DEC AH
MOV DX, 8001H
OUT DX, AL
MOV DX, 8000H
MOV AL, 0FFH
OUT DX, AL
LOOP A3
MOV AH, 85H
JMP CONT

CALC:
POP BX
POP AX
MOV CL, 10
MUL CL
ADD AX, BX
MOV CX, AX    ;SPEED IN CX
POP BX
POP AX
MOV DL, 10
MUL DL
ADD BX, AX
POP AX
MOV DL, 100
MUL DL
ADD AX, BX    ;DEGREE IN AX
JMP CONT2

MOVE:
;MOV BL, 100
;PUSH AX
;MOV AX, CX
;MUL BL
;MOV CX, AX
;POP AX
;MOV SPEED, CX
MOV BX, 10
MUL BX
MOV DX, 0
MOV BX, 7
DIV BX

PUSH AX                  ;NEW
CMP AX, DEG
JE CONT3
CMP AX, DEG
JA LR

MOV BX, DEG
SUB BX, AX
MOV AX, BX
MOV FLAG, 1
JMP CONT4

LR:
SUB AX, DEG
MOV FLAG, 0
JMP CONT4

CONT4:
POP DX
MOV DEG, DX
MOV BL, 88H
MOV DX, 0FF28H

L9:
PUSH AX
MOV AL, BL
OUT DX, AL
CMP FLAG, 0
JE L10
ROL BL, 1
JMP CONT5
L10:
ROR BL, 1
CONT5:
PUSH CX
CALL DELAY
POP CX
POP AX
DEC AX
CMP AX, 0
JNE L9
JMP CONT3

DELAY PROC NEAR
      MOV CX, 500
      LD:
      NOP
      LOOP LD
      RET
DELAY ENDP

ARR1 DB 8FH, 99H, 8H, 29H, 9H, 28H, 88H, 38H
ARR2 DB 9FH, 0CH, 4AH, 0E8H, 0BH, 68H, 6CH, 1AH

ARR1N DB 7, 4, 8, 5, 9, 6, 0, 0
ARR2N DB 1, 0, 2, 0, 3, 0, 0, 0

END START
CODE ENDS
